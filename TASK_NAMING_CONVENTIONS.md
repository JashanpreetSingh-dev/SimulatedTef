# Task Naming Conventions - Practice vs Mock Exams

This document outlines the naming conventions for tasks used in practice assessments versus mock exam modules.

## Summary

**Both practice and mock exams use the SAME naming conventions for tasks.** The difference is in how tasks are selected and stored, not in their naming.

## Task ID Formats

### 1. **Oral Expression Tasks (TEFTask)**

**Data Structure:**
- **Field Name**: `id` (number)
- **Storage**: JSON files (`data/section_a_knowledge_base.json`, `data/section_b_knowledge_base.json`)
- **Example IDs**: `1`, `2`, `3`, etc.

**Normalized Task ID Format:**
- **Section A (EO1)**: `oralA_{id}` → `oralA_1`, `oralA_2`, `oralA_3`
- **Section B (EO2)**: `oralB_{id}` → `oralB_1`, `oralB_2`, `oralB_3`
- **Generated by**: `generateTaskId()` function in `types/task.ts`
- **Pattern**: `{type}_{numeric_id}`

**Code Example:**
```typescript
// TEFTask structure
interface TEFTask {
  id: number;  // e.g., 1, 2, 3
  section: string;
  prompt: string;
  // ...
}

// Normalized taskId
generateTaskId('oralA', tefTask)  // Returns: "oralA_1"
generateTaskId('oralB', tefTask)  // Returns: "oralB_2"
```

**In Mock Exams:**
- Stored in MockExam schema as: `oralATaskId: "oralA_3"`, `oralBTaskId: "oralB_1"`
- Format: `"oralA_{numeric_id}"`, `"oralB_{numeric_id}"`

---

### 2. **Written Expression Tasks (WrittenTask)**

**Data Structure:**
- **Field Name**: `id` (string)
- **Storage**: MongoDB (`writtenTasks` collection)
- **Example IDs**: `"writtenA_1"`, `"writtenB_2"`, etc.

**Normalized Task ID Format:**
- **Section A**: `writtenA_{id}` → `writtenA_1`, `writtenA_2`
- **Section B**: `writtenB_{id}` → `writtenB_1`, `writtenB_2`
- **Pattern**: `{type}_{numeric_id}`
- **Note**: The `id` field already contains the full taskId (e.g., `"writtenA_1"`)

**Code Example:**
```typescript
// WrittenTask structure
interface WrittenTask {
  id: string;  // e.g., "writtenA_1", "writtenB_2"
  section: 'A' | 'B';
  subject: string;
  // ...
}

// Normalized taskId (id is already in correct format)
generateTaskId('writtenA', writtenTask)  // Returns: writtenTask.id (e.g., "writtenA_1")
```

**In Mock Exams:**
- Stored directly as string IDs in the session's `taskIds` array
- Format: `"writtenA_1"`, `"writtenB_2"` (stored as-is)

---

### 3. **Reading Comprehension Tasks (ReadingTask)**

**Data Structure:**
- **Field Name**: `taskId` (string)
- **Storage**: MongoDB (`readingTasks` collection)
- **Example IDs**: `"reading_1"`, `"reading_2"`, `"reading_3"`

**Normalized Task ID Format:**
- **Pattern**: `reading_{numeric_id}` → `reading_1`, `reading_2`, `reading_3`
- **Note**: The `taskId` field already contains the full format
- **Generated by**: Backend service when creating tasks (incremental numbering)

**Code Example:**
```typescript
// ReadingTask structure
interface ReadingTask {
  taskId: string;  // e.g., "reading_1", "reading_2"
  type: 'reading';
  prompt: string;
  // ...
}

// Normalized taskId (taskId is already in correct format)
generateTaskId('reading', readingTask)  // Returns: readingTask.taskId (e.g., "reading_1")
```

**In Mock Exams:**
- Stored in MockExam schema as: `readingTaskId: "reading_1"`
- Format: `"reading_{numeric_id}"`

**Question IDs:**
- Format: `{taskId}_q{questionNumber}` → `reading_1_q1`, `reading_1_q2`, ..., `reading_1_q40`
- Example: For `reading_1`, questions are: `reading_1_q1`, `reading_1_q2`, ..., `reading_1_q40`

---

### 4. **Listening Comprehension Tasks (ListeningTask)**

**Data Structure:**
- **Field Name**: `taskId` (string)
- **Storage**: MongoDB (`listeningTasks` collection)
- **Example IDs**: `"listening_1"`, `"listening_2"`, `"listening_3"`

**Normalized Task ID Format:**
- **Pattern**: `listening_{numeric_id}` → `listening_1`, `listening_2`, `listening_3`
- **Note**: The `taskId` field already contains the full format
- **Generated by**: Backend service when creating tasks (incremental numbering)

**Code Example:**
```typescript
// ListeningTask structure
interface ListeningTask {
  taskId: string;  // e.g., "listening_1", "listening_2"
  type: 'listening';
  prompt: string;
  // ...
}

// Normalized taskId (taskId is already in correct format)
generateTaskId('listening', listeningTask)  // Returns: listeningTask.taskId (e.g., "listening_1")
```

**In Mock Exams:**
- Stored in MockExam schema as: `listeningTaskId: "listening_1"`
- Format: `"listening_{numeric_id}"`

**Question IDs:**
- Format: `{taskId}_q{questionNumber}` → `listening_1_q1`, `listening_1_q2`, ..., `listening_1_q40`
- Example: For `listening_1`, questions are: `listening_1_q1`, `listening_1_q2`, ..., `listening_1_q40`

---

## Naming Pattern Summary

| Task Type | Field Name | Data Type | Format | Example | Storage |
|-----------|------------|-----------|--------|---------|---------|
| **Oral Expression (A)** | `id` | `number` | `oralA_{id}` | `oralA_1`, `oralA_2` | JSON files |
| **Oral Expression (B)** | `id` | `number` | `oralB_{id}` | `oralB_1`, `oralB_2` | JSON files |
| **Written Expression (A)** | `id` | `string` | `writtenA_{id}` | `writtenA_1`, `writtenA_2` | MongoDB |
| **Written Expression (B)** | `id` | `string` | `writtenB_{id}` | `writtenB_1`, `writtenB_2` | MongoDB |
| **Reading** | `taskId` | `string` | `reading_{id}` | `reading_1`, `reading_2` | MongoDB |
| **Listening** | `taskId` | `string` | `listening_{id}` | `listening_1`, `listening_2` | MongoDB |

**General Pattern:**
```
{type}_{numeric_id}
```
Where:
- `{type}` = `oralA` | `oralB` | `writtenA` | `writtenB` | `reading` | `listening`
- `{numeric_id}` = Sequential number (1, 2, 3, ...)

---

## Question Naming Conventions

**Reading/Listening Questions:**
- **Format**: `{taskId}_q{questionNumber}`
- **Examples**:
  - Reading: `reading_1_q1`, `reading_1_q2`, ..., `reading_1_q40`
  - Listening: `listening_1_q1`, `listening_1_q2`, ..., `listening_1_q40`

**Code Example:**
```typescript
// Question ID generation (from migration script)
questionId = `${taskId}_q${questionNumber}`
// e.g., "reading_1_q1", "listening_2_q15"
```

---

## Practice vs Mock Exams - Task Selection

### Practice Assessments

**Oral Expression:**
- Tasks selected randomly from JSON files using `getRandomTasks()`
- TEFTask objects with `id: number` (e.g., `{ id: 3, section: "EO1", ... }`)
- Normalized to `oralA_3`, `oralB_1` when stored in results

**Written Expression:**
- Tasks selected randomly from MongoDB
- WrittenTask objects with `id: string` (e.g., `{ id: "writtenA_1", ... }`)
- Stored as-is in results

**Reading/Listening:**
- Tasks selected randomly from MongoDB via API
- ReadingTask/ListeningTask objects with `taskId: string` (e.g., `{ taskId: "reading_1", ... }`)
- Stored as-is in results

### Mock Exam Modules

**All Modules:**
- Tasks are **pre-defined** in the MockExam document
- Stored as string task IDs in MockExam schema:
  ```typescript
  {
    mockExamId: "mock_1",
    oralATaskId: "oralA_1",      // Pre-defined
    oralBTaskId: "oralB_1",      // Pre-defined
    readingTaskId: "reading_1",  // Pre-defined
    listeningTaskId: "listening_1", // Pre-defined
  }
  ```
- Tasks are loaded from their respective sources (JSON files or MongoDB) using the pre-defined IDs
- Same naming conventions as practice - just pre-selected instead of random

**Session Storage:**
- All task IDs stored in exam session's `taskIds` array:
  ```typescript
  taskIds: [
    "oralA_1",
    "oralB_1", 
    "reading_1",
    "listening_1",
    "writtenA_1",  // Written tasks stored by their id field
    "writtenB_1"
  ]
  ```

---

## Result Storage (SavedResult)

**Task References (Normalized Format):**
```typescript
taskReferences: {
  taskA?: TaskReference;  // { taskId: string, type: 'oralA' | 'writtenA' | 'reading' }
  taskB?: TaskReference;  // { taskId: string, type: 'oralB' | 'writtenB' | 'listening' }
}
```

**Examples:**
- Oral Expression: `{ taskId: "oralA_3", type: "oralA" }`, `{ taskId: "oralB_1", type: "oralB" }`
- Written Expression: `{ taskId: "writtenA_1", type: "writtenA" }`, `{ taskId: "writtenB_2", type: "writtenB" }`
- Reading: `{ taskId: "reading_1", type: "reading" }`
- Listening: `{ taskId: "listening_1", type: "listening" }`

**Legacy Fields (deprecated):**
- `taskPartA?: TEFTask` - Full TEFTask object (practice only)
- `taskPartB?: TEFTask` - Full TEFTask object (practice only)

---

## Key Differences Summary

| Aspect | Practice | Mock Exams |
|--------|----------|------------|
| **Task Selection** | Random selection | Pre-defined in MockExam |
| **Task Naming** | **Same conventions** | **Same conventions** |
| **Oral Tasks** | `oralA_{id}`, `oralB_{id}` | `oralA_{id}`, `oralB_{id}` |
| **Written Tasks** | `writtenA_{id}`, `writtenB_{id}` | `writtenA_{id}`, `writtenB_{id}` |
| **Reading Tasks** | `reading_{id}` | `reading_{id}` |
| **Listening Tasks** | `listening_{id}` | `listening_{id}` |
| **Storage** | Individual results | Linked to mockExamId |
| **Task IDs in Session** | Not stored (single session) | Stored in `taskIds` array |

---

## Code References

**Task ID Generation:**
- `types/task.ts` - `generateTaskId()` function
- Converts different task types to normalized string format

**Task Selection:**
- `services/tasks.ts` - Practice task selection functions
- `server/services/mockExamService.ts` - Mock exam task loading

**Task Storage:**
- `types.ts` - Task interfaces and SavedResult structure
- `server/models/MockExam.ts` - MockExam schema with task IDs

**Question ID Generation:**
- `server/scripts/migrateReadingListeningToDB.ts` - Question ID format: `{taskId}_q{number}`